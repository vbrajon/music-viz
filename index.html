<meta charset="utf-8">
<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">

<style>body { background: black;margin: 0; }</style>
<canvas></canvas>

<script>
canvas = document.querySelector('canvas')
ctx = canvas.getContext('2d')
canvas.width = window.innerWidth
canvas.height = window.innerHeight
cx = canvas.width / 2
cy = canvas.height / 2
cos = Math.cos
sin = Math.sin

ctrl = { pause: false, inverse: false }
window.addEventListener('click', () => ctrl.pause = !ctrl.pause)
window.addEventListener('keypress', e => {
  const key = e.code.toLowerCase().replace(/^key/, '')
  if (key === 'space') ctrl.pause = !ctrl.pause
  if (key === 'i') ctrl.inverse = !ctrl.inverse
  // console.log(key, e)
})

let c = 0
let up = true
loop()
function loop() {
  requestAnimationFrame(loop)
  if (ctrl.pause) return
  ctx.fillRect(0, 0, canvas.width, canvas.height)
  if (c > 1) up = false
  if (c < 0) up = true
  if (up) c += .02
  else c -= .01
  bass(c)
  violin(c)
  guitar(c)
  organ(c)
  percussions(c)
  chorus(c)
  lead(c)
  if (ctrl.inverse) inverse()
}

// lead - voice
function lead(percentage) {
  ctx.strokeStyle = 'rgba(255, 255, 255, .8)'
  ctx.lineWidth = 1
  const size = percentage * 50
  arc(260)
  linecircle(260, 260 + size, 10, 5)
}

// chorus - voice
function chorus(percentage) {
  ctx.strokeStyle = 'rgba(255, 255, 255, .8)'
  ctx.lineWidth = 1
  const size = percentage * 50
  arc(250)
  linecircle(250, 250 + size, 10)
}

// violin - string
function violin(percentage) {
  ctx.strokeStyle = 'white'
  ctx.lineWidth = 3
  ctx.lineCap = 'round'
  const size = percentage * 50
  arc(200 - 15, 5 - size, 20)
  arc(200 - 10, 20, 50 + size)
  arc(200 - 5, 180 - size, 220 + size)
  arc(200, 12 + size, 60 + size)
  ctx.lineCap = 'butt'
}

// guitar - string
function guitar(percentage) {
  ctx.strokeStyle = 'white'
  ctx.lineWidth = 5
  ctx.lineCap = 'round'
  const size = percentage * 50
  arc(50 - 15, 5 - size, 20)
  arc(50 - 10, 20, 50 + size)
  arc(50 - 5, 180 - size, 220 + size)
  arc(50, 12 + size, 60 + size)
  ctx.lineCap = 'butt'
}

// organ - wind
function organ(percentage) {
  ctx.strokeStyle = 'rgba(255, 255, 255, ' + (.2 + percentage / 2) + ')'
  ctx.lineWidth = 1 + percentage * 5
  const size = percentage * 50
  linecircle(60, 120)
}

// bass - string
function bass(percentage) {
  ctx.strokeStyle = 'rgba(255, 255, 255, .5)'
  ctx.lineWidth = 2
  const size = percentage * 30
  arc(size - 8)
  arc(size - 4)
  arc(size)
}

// percussions - drum
function percussions(percentage) {
  ctx.strokeStyle = 'white'
  ctx.lineWidth = 1
  arc(140)
  const size = percentage * 30
  ctx.lineWidth = 5
  linecircle(145, 145 + size, 8)
  linecircle(145, 145 + (size / 2), 8, 4)
}

function inverse() {
  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height)
  const data = imageData.data
  for(let i = 0;i < data.length;i += 4) {
    data[i] = 255 - data[i] // r
    data[i + 1] = 255 - data[i + 1] // g
    data[i + 2] = 255 - data[i + 2] // b
  }
  ctx.putImageData(imageData, 0, 0)
}

// x = cx + r * cos(a)
// y = cy + r * sin(a)
function linecircle(inner, outer, inc = 4, a = 0) {
  while (a < 360) {
    line(inner * cos(a * Math.PI / 180), inner * sin(a * Math.PI / 180), outer * cos(a * Math.PI / 180), outer * sin(a * Math.PI / 180), false)
    a += inc
  }
}

function line(x, y, dx, dy, delta = true) {
  ctx.beginPath()
  ctx.moveTo(cx + x, cy + y)
  if (delta) ctx.lineTo(cx + x + dx, cy + y + dy)
  if (!delta) ctx.lineTo(cx + dx, cy + dy)
  ctx.stroke()
}

function arc(radius, a, da, delta = true) {
  if (radius <= 0) return
  if (!a) a = 0
  if (!da) da = 360
  ctx.beginPath()
  if (delta) ctx.arc(cx, cy, radius, Math.PI / 180 * a, Math.PI / 180 * a + Math.PI / 180 * da)
  if (!delta) ctx.arc(cx, cy, radius, Math.PI / 180 * a, Math.PI / 180 * da)
  ctx.stroke()
}
</script>
